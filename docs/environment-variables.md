# Environment Variables

When adding or changing an environment variable:
1. Update the example.env file
1. Update the 1password .env file
1. Update the kubernetes configuration yaml files
1. Let the team know they need to update their .env file(s) for local development

## Update the example.env file
In the repo, make sure the `example.env` file for the service or services using the environment
variable contains the update. Example: if adding `NEW_ENV_VAR` for the API, update `api/example.env`
and add `NEW_ENV_VAR=default`. Commit this to the repo as part of your PR.

## Update the 1password .env file
If the new environment variable will contain a secret, it needs to be added to 1password.
In the shared bonkeybong vault, find the `Portway Dev .env file` note and add the new env var
with the default secret for dev.

## Update the kubernetes configuration yaml files
To expose environment variables to Portway deployed environments, kubernetes needs to know about the
env vars. See `kubernetes/dev/api-deployment.yaml` and `kubernetes/dev/config.yaml` for examples.
If the env var is a secret, the secret needs to be added to the environments. There is no defined
process for setting secrets yet, so be sure to check with the team on how to do this.

## Communicate the update to the team
Make sure people know they need to update their local .env with the new value!

# API Environment Variables
**API_PORT**: port number the API will run on  
**PASSWORD_RESET_JWT_SECRET**: A JSON Web Token secret used for resetting passwords and initial password creation  
**DB_HOST**: The database host name. For remote databases, use a FQDN  
**DB_PORT**: The database port  
**DB_USER**: The database user. Needs admin access to db (CRUD table schemas etc.)  
**DB_PASSWORD**: The password for the database user  
**DB_NAME**: The name of the database  
**DB_USE_SSL**: Set to `true` string for a secure database connection  
**LOG_DB_COMMANDS**: For local development or debugging, log SQL queries generated by sequelize  
**DEBUG** : The node debug module. Set to `portway:*` to log Portway debug lines  
**AWS_ACCESS_KEY_ID**: The AWS access key for the API  
**AWS_SECRET_ACCESS_KEY**: The secret key for the access key id  
**AWS_SES_REGION**: The AWS SES region  
**SENDER_EMAIL_ADDRESS**: The email address for which Portway emails will be sent from  
**CLIENT_URL**: The FQDN of the client  
**STRIPE_SECRET**: The Stripe secret  
**STRIPE_HOOK_SECRET**: The Stripe webhook secret  
**S3_CONTENT_BUCKET**: The name of the S3 bucket where assets are stored  
**CDN_HOSTNAME**: The FQDN of the Cloudfront CDN. No trailing slash  
**LOG_TOKEN**: When using the `r7insight` logger, the associated log token   
**AUDIT_LOG_TOKEN**: When set, the `r7insight` logger is turned on for the audit log  
**ADMIN_SECRET_KEY**: A secret key used for authorizing admin actions  
**REDIS_URL**: The url to the redis instance. Optionally used for rate-limiting. Uses in-memory store if not set
**SLACK_WEBHOOK_URL**: The url to use with the slack webhook api, for posting notifications to the portway-support slack channel

# Web Environment Variables
**STRIPE_PUBLISHABLE_KEY**: The publishable key from Stripe. Used to manage subscriptions and collect payment info.  
**API_URL**: The locally resolveable url to the API. In a kubernetes cluster, this may be `http://api-service:3001` for example.
**API_PUBLIC_URL**: The publicly accessible FQDN for the API. Used to make API calls from the client javascript app.  
**FLAG_DISABLE_SIGNUP**: Turns off the sign up form and endpoint when set to the string `true`  
**LOG_TOKEN_WEB**: An r7insight token for web logging

# Shared Environment Variables
**JWT_SECRET**: A secret string used to sign and verify JSON Web Tokens used for app authentication  
**LOGGER**: The logger the app should use. Valid values defined in `constants/logging.js`  

